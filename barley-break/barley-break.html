<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Barley-Break</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <style>


        /*--------------------------------------------------------------------------------------------------------------*/
        /*
        reset default css style
        http://meyerweb.com/eric/tools/css/reset/
   v2.0 | 20110126
   License: none (public domain)
*/

        /*html, body, div, span, applet, object, iframe,
        h1, h2, h3, h4, h5, h6, p, blockquote, pre,
        a, abbr, acronym, address, big, cite, code,
        del, dfn, em, img, ins, kbd, q, s, samp,
        small, strike, strong, sub, sup, tt, var,
        b, u, i, center,
        dl, dt, dd, ol, ul, li,
        fieldset, form, label, legend,
        table, caption, tbody, tfoot, thead, tr, th, td,
        article, aside, canvas, details, embed,
        figure, figcaption, footer, header, hgroup,
        menu, nav, output, ruby, section, summary,
        time, mark, audio, video {
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            font: inherit;
            vertical-align: baseline;
        }

        !* HTML5 display-role reset for older browsers *!
        article, aside, details, figcaption, figure,
        footer, header, hgroup, menu, nav, section {
            display: block;
        }

        body {
            line-height: 1;
        }

        ol, ul {
            list-style: none;
        }

        blockquote, q {
            quotes: none;
        }

        blockquote:before, blockquote:after,
        q:before, q:after {
            content: '';
            content: none;
        }

        table {
            border-collapse: collapse;
            border-spacing: 0;
        }*/

        /*--------------------------------------------------------------------------------------------------------------*/
        input {
            font-size: 15px;
            margin: 20px;
        }

        .main {
            width: 400px;
            height: 400px;
            background-color: aquamarine;
            border: 2px solid blue;
            text-align: left;
            display: inline-block;
            padding: 2px;
            margin: 0px;
        }

        .square {
            width: 88px;
            height: 88px;
            border: 2px solid blue;
            float: left;
            text-align: center;
            font-size: 50px;
            margin: 2px;
            padding: 2px;
            border-radius: 10px;
            background-color: #f9f9f9;
            line-height: 88px;
        }

        .page {
            max-width: 400px;
            margin: auto;
        }

        .empty {
            border: 2px solid aquamarine;
            background-color: aquamarine;
        }
    </style>
</head>
<body>
<input type="button" value="Restart"/>
<div class="page">
    <div class="main">
        <div id="1" class="square">
            1
        </div>
        <div id="2" class="square">
            2
        </div>
        <div id="3" class="square">
            3
        </div>
        <div id="4" class="square">
            4
        </div>
        <div id="5" class="square">
            5
        </div>
        <div id="6" class="square">
            6
        </div>
        <div id="7" class="square">
            7
        </div>
        <div id="8" class="square">
            8
        </div>
        <div id="9" class="square">
            9
        </div>
        <div id="10" class="square">
            10
        </div>
        <div id="11" class="square">
            11
        </div>
        <div id="12" class="square">
            12
        </div>
        <div id="13" class="square">
            13
        </div>
        <div id="14" class="square">
            14
        </div>
        <div id="15" class="square">
            15
        </div>
        <div id="16" class="square empty">

        </div>
    </div>
</div>

<script>

    var elemHaveStep = function (targetCell, emptyCell) {
        if (targetCell.hasClass('empty')) {
            return false;
        }
        targetCellId = parseInt(targetCell.attr('id'));
        emptyCellId = parseInt(emptyCell.attr('id'));

        if ((emptyCellId == (targetCellId + 1) && ![5, 9, 13].includes(emptyCellId))
            || (emptyCellId == (targetCellId - 1) && ![4, 8, 12].includes(emptyCellId))
            || emptyCellId == (targetCellId + 4)
            || emptyCellId == (targetCellId - 4)) {
            return true;
        }
        return false;
    };


    var checkForWin = function () {
//        var arr = $('.square');
        var arr = $('.main > div');
//        console.log(arr);
//        console.log(arr[0]);
//        var s = arr[0];
        for (var i = 1; i <= 15; i++) {
//            console.log(" i = " + i);
//            console.log("arr[i] = " + arr.eq(i).attr('id'));
//            console.log("arr[i] = " + arr.eq(i).text());
            if (i != arr.eq(i - 1).text()) {
                return false;
            }
        }
        return true;

    };

    function swap(targetCell, emptyCell) {
        if (elemHaveStep(targetCell, emptyCell)) {
            var value = targetCell.text();
            targetCell
                .addClass('empty')
                .text('');

            emptyCell
                .removeClass('empty')
                .text(value);


            if (checkForWin()) {//todo delete
//                console.log('you are win');
//                alert(" YOU ARE WINNER!!!");//TODO must first move cell and then show alert???
            }
        } else {
            //todo set red border for 1sec
            console.log('elem not have next step')
        }

    }

    $('.square').click(function () {
        var targetCell = $(this);
        var emptyCell = $('.empty');
//        var message = targetCell.text();
//        console.log(message);

        swap(targetCell, emptyCell);

        /*
         if (elemHaveStep(targetCell, emptyCell)) {
         //do step
         //            console.log('elem has next step')

         var value = targetCell.text();
         targetCell
         .addClass('empty')
         .text('');
         //            targetCell.text('');
         emptyCell
         .removeClass('empty')
         .text(value);
         //            emptyCell.text(value);

         if (checkForWin()) {//todo delete
         //                console.log('you are win');
         alert(" YOU ARE WINNER!!!");//TODO must first move cell and then show alert???
         }
         } else {
         //todo set red border for 1sec
         console.log('elem not have next step')
         }
         */
        if (checkForWin()) { // todo uncomment
            console.log('you are win');
//         alert(" YOU ARE WINNER!!!");//TODO must first move cell and then show alert???
        }
    });

    $('input').click(function () {
        startingMix();
    });


    function startingMix() {
        var mixSteps = 500;
        for (var i = 0; i < mixSteps; i++) {
            var emptyCell = $('.empty');
            var emptyCellId = parseInt(emptyCell.attr('id'));
            var existingSteps = [];
            var step1 = emptyCellId + 1;
            var step2 = emptyCellId - 1;
            var step3 = emptyCellId + 4;
            var step4 = emptyCellId - 4;
            if (step1 != 5 && step1 != 9 && step1 != 13 && step1 != 17) {
                existingSteps.push(step1);
            }
            if (step2 != 0 && step2 != 4 && step2 != 8 && step2 != 12) {
                existingSteps.push(step2);
            }
            if (step3 <= 16) {
                existingSteps.push(step3);
            }
            if (step4 >= 1) {
                existingSteps.push(step4);
            }
            var targetCellId = existingSteps[Math.round(Math.random() * (existingSteps.length - 1))];
            var targetCell = $('#' + targetCellId);
            swap(targetCell, emptyCell);
        }
    }
    //start
    startingMix();
</script>
</body>
</html>